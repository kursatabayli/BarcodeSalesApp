@page "/product-list"
@using BarcodeSalesApp.App.Models.ProductModels
@using BarcodeSalesApp.App.Resources.Strings
@using BarcodeSalesApp.Application.Features.CQRS.Products.Queries


<MudItem class="d-flex align-center justify-space-between mb-6">
    <MudText Typo="Typo.h3" Class="d-flex align-center">
        <MudIcon Icon="@Icons.Material.Filled.List" Class="mr-2" />
        @Localizer[AppStrings.ProductList]
    </MudText>
    <MudSpacer />
    <MudButton OnClick="AddProduct" Color="Color.Primary" Variant="Variant.Filled">
        @Localizer[AppStrings.AddProduct]
    </MudButton>
</MudItem>

<MudTable T="ProductModel" ServerData="ServerReload" @ref="_table" Hover="true" FixedHeader="true" Dense="true"
    SortLabel="@Localizer[AppStrings.SortBy]">

    <ToolBarContent>
        <MudSpacer />
        <MudTextField @bind-Value="SearchText" Placeholder="@Localizer[AppStrings.Search]" Adornment="Adornment.Start"
            AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Variant="Variant.Outlined"
            Immediate="true" DebounceInterval="300" Class="mt-0" Clearable />
    </ToolBarContent>

    <HeaderContent>
        <MudTh>#</MudTh>
        <MudTh>
            <MudTableSortLabel T="ProductModel" SortLabel="@nameof(ProductSortColumn.Name)">
                @Localizer[AppStrings.ProductName]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel T="ProductModel" SortLabel="@nameof(ProductSortColumn.PurchasePrice)">
                @Localizer[AppStrings.PurchasePrice]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel T="ProductModel" SortLabel="@nameof(ProductSortColumn.SalePrice)">
                @Localizer[AppStrings.SalePrice]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel T="ProductModel" SortLabel="@nameof(ProductSortColumn.Profit)">
                @Localizer[AppStrings.Profit]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel T="ProductModel" SortLabel="@nameof(ProductSortColumn.StockQuantity)">
                @Localizer[AppStrings.StockUnit]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            @Localizer[AppStrings.ProductDetail]
        </MudTh>
    </HeaderContent>

    <RowTemplate Context="product">
        <MudTd hidden="true">@product.Barcode</MudTd>
        <MudTd DataLabel="#">@(++Count)</MudTd>
        <MudTd DataLabel="@Localizer[AppStrings.ProductName]">@product.Name</MudTd>
        <MudTd DataLabel="@Localizer[AppStrings.PurchasePrice]">@product.PurchasePrice.ToString("C")</MudTd>
        <MudTd DataLabel="@Localizer[AppStrings.SalePrice]">@product.SalePrice.ToString("C")</MudTd>
        <MudTd DataLabel="@Localizer[AppStrings.Profit]">@($"{product.SalePrice - product.PurchasePrice:C}")</MudTd>
        <MudTd DataLabel="@Localizer[AppStrings.StockUnit]">@product.QuantityInStock</MudTd>
        <MudTd DataLabel="@Localizer[AppStrings.ProductDetail]">
            <MudButton OnClick="() => ProductDetail(product)" Color="Color.Info" Variant="Variant.Outlined">
                @Localizer[AppStrings.ViewDetails]
            </MudButton>
        </MudTd>
    </RowTemplate>

    <PagerContent>
        <MudTablePager RowsPerPageString="@Localizer[AppStrings.RowsPerPage]"
            InfoFormat="{first_item}-{last_item} of {all_items}" />
    </PagerContent>
</MudTable>